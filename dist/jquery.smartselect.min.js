/**
 * ========================================================
 * SmartSelect - A smart jquery multiple select plugin
 * ========================================================
 *
 * @author     Hong Zhang <smartselect@126.com>
 * @version    1.0.24
 */
!function(t,e){function i(e,i){this.element=e,this.$element=t(e),this.options=t.extend(!0,{},this.defaults,i),this.o=this.options,this.x=this.options.text,this.s=this.options.style,this.e=this.options.event,this.m=this.options.marker,this.t=this.options.template,this.a=this.options.attribute,this.c={};for(var s in this.callback)this.callback.hasOwnProperty(s)&&(this.c[s]=t.merge([],this.callback[s]),this.o.callback[s]&&this.addCallback(s,this.o.callback[s]));this._init()}function s(e,s){return this.each(function(){var a=t(this);if("destroy"===e)return void a.data(l,!1);var n=a.data(l);return n?void("string"==typeof e&&n[e].apply(n,s)):void a.data(l,n=new i(this,e))})}var a="pa",n="smartselect",o="."+a+"."+n,l=a+"."+n;i.VERSION="1.0.24",i.prototype={defaults:{multiple:!0,optimized:!1,delayedInit:!0,debug:0,debugLevel:10,maxLevels:5,searchTimeout:!1,alert:function(t){alert(t)},confirm:function(t){return confirm(t)},getSpecialLabel:function(t,e){return t.find("input").val()},setSpecialValue:function(t,i,s){var a=t.split(s.o.specialValueSeperator);a[1]!==e&&(i===e&&a[0]!==e&&(i=s._getOptionByValue(a[0])),i.find("input").val(a[1]))},getSpecialValue:function(t,e){return t.attr(e.a.dataValue)+e.o.specialValueSeperator+t.find("input").val()},closeOnSelect:!1,closeOtherSmartSelect:!0,closeOnClickOutside:!1,defaultValues:null,initialValues:[],keepInSync:!0,clickGroupOpen:!0,showSelectedInLabel:!0,showSelectedCount:2,showSelectedCallback:null,showSelectedSeperator:",",specialValueSeperator:"::",defaultView:"root+selected+view",viewAfterCheckAll:!0,viewAfterCancel:!0,viewAfterAlias:!0,forceUnCheckTriggerEvent:!1,closeAfterAlias:!0,disableUserAlias:!1,enableCollapseAll:!0,searchBy:"label",searchCaseInsensitive:!0,atLeast:0,atMost:0,mustSelect:[],dataLevelInclusive:!1,style:{container:"dropdown",select:"dropdown-toggle btn btn-default",selectIcon:"",selectLabel:"",selectCaret:"caret",dropdown:"dropdown-menu",toolbarPos:"",toolbar:"btn-group-vertical",button:"btn btn-default",buttonGroup:"btn-group",buttonToggle:"btn btn-default dropdown-toggle",buttonCaret:"caret",buttonDropdown:"dropdown-menu pull-right",liInput:"form-group-sm",inputBox:"form-control",buttonView:"fa fa-fw fa-eye",buttonUnfold:"fa fa-fw fa-folder-o",buttonFoldOpen:"fa fa-fw fa-folder-open-o",buttonCancel:"fa fa-fw fa-undo",buttonCheckAll:"fa fa-fw fa-check",buttonUnCheck:"fa fa-fw fa-times",buttonSearch:"fa fa-fw fa-search",folderOpen:"fa fa-folder-open-o",folderClose:"fa fa-folder-o",divider:"divider",checker:"fa fa-fw fa-check-square-o",checkerNo:"fa fa-fw fa-square-o",dropup:"dropup",buttonAlias:"fa fa-fw fa-star-o",alias:"",aliasIcon:"fa fa-star-o",aliasCaret:"fa fa-times"},marker:{container:"smartselect",label:"ss-label",caret:"ss-caret",icon:"ss-icon",toolbar:"ss-toolbar",divider:"ss-divider",hide:"ss-hide",open:"open",active:"active",disabled:"disabled",folder:"ss-folder",folderOpen:"ss-open",folderClose:"ss-close",expandAll:"fa-folder-open-o",button:"ss-button",group:"ss-group",noGroup:"ss-nogrp",option:"ss-option",optionNotSelectable:"ss-option-off",checker:"ss-checker",checkerNo:"ss-checkno",noBubble:"ss-nobubble",alias:"ss-alias"},template:{container:"<div></div>",select:'<button type="button"><i class="ss-icon"></i><span class="ss-label"></span><i class="ss-caret"></i></button>',dropdown:"<ul></ul>",toolbar:'<li><div role="toolbar"></div></li>',button:'<button type="button"><i class="ss-icon"></i></button>',buttonToggle:'<button type="button"><i class="ss-icon"></i><i class="ss-caret"></i></button>',buttonGroup:"<div></div>",liInput:'<li><div><input type="text" /></div></li>',divider:'<li class="ss-divider"></li>',alias:'<li class="ss-alias"><a><i class="ss-icon"></i><i class="ss-caret"></i><span class="ss-label"></span></a></li>',folder:'<i class="ss-folder ss-close"></i><i class="ss-folder ss-open"></i>'},toolbar:{buttonSearch:!0,buttonAlias:!0,buttonView:"root+selected",buttonUnfold:!0,buttonCancel:!0,buttonCheckAll:!0,buttonUnCheck:!0},event:{click:"click",buttonClick:"click",optionSelect:"click",dropdownToggle:"click"},attribute:{dataView:"data-view",dataMust:"data-must",dataLevel:"data-level",dataValue:"data-value",dataUpper:"data-upper",dataAtMost:"data-atmost",dataSpecial:"data-special",dataDivider:"data-divider",dataAtLeast:"data-atleast",dataExclusive:"data-exclusive",dataInclusive:"data-inclusive",dataNotSelectable:"data-not-selectable",dataLevelInclusive:"data-level-inc",dataGroupExclusive:"data-group-exclusive"},text:{selectLabel:"Smart Select",labelTemplate:"# selected",disabled:"Disabled",buttonSearch:"search options",buttonAlias:"option aliases",buttonView:"view only selected",buttonUnfold:"expanded/collapse view",buttonCancel:"cancel selected options",buttonCheckAll:"select all",buttonUnCheck:"deselect all",aliasPlaceholder:"Save as alias",searchPlaceholder:"Search ...",groupExcludeError:'"data-atleast" can not use with "data-group-exclusive"',callbackError:"unknown callback ",valueSetError:"set value error ",invalidOptionError:"invalid option",badArgumentError:"bad argument ",emptyValuesError:"no option selected",aliasDupError:"alias duplicated",duplicationError:"duplicated option found"},handler:{},callback:{},data:[],aliases:{}},callback:{onPluginLoad:["_fixPluginOptions","_hideOriginalSelect"],onPluginLoaded:["_setDefaultValues","_fixEmptyLogic","_flushSelect","_setSelectLabel","_matchAliasName","_syncSelect","_disabledSelect"],onDropdownShow:["_delayedInit"],onDropdownShown:["_saveOldValues","_updateIcons"],onDropdownHide:[],onDropdownHidden:["_syncSelect"],onOptionChange:[],onOptionChanged:["_flushSelect","_setSelectLabel","_matchAliasName","_closeOnSelect"],onOptionDisable:[],onOptionDisabled:["_fixEmptyLogic"],onOptionSelect:["_atMost"],onOptionSelected:["_fixSelectLogic"],onOptionDeselect:["_fixEmptyLogic"],onOptionDeselected:[]},selectOptions:function(t,e){return this._debug("selectOptions"),this.isDisabled()?this:(this._triggerEvent("onOptionChange")&&(e!==!1&&this._clearValues(),this._setValues(t),e!==!1&&this._fixEmptyLogic(),this._triggerEvent("onOptionChanged")),this)},deselectOptions:function(t){return this._debug("deselectOptions"),this.isDisabled()?this:(this._triggerEvent("onOptionChange")&&(this._unSetValues(t),this._triggerEvent("onOptionChanged")),this)},getValues:function(){if(this._debug("getValues"),this.isDisabled())return[];var t=this.getSelectedPairs();return t.value},isDisabled:function(){return this.$select.hasClass(this.m.disabled)},disableSelect:function(){return this._debug("disableSelect"),this.isDisabled()?this:(this.closeDropdown(),this.$select.addClass(this.m.disabled),this._setSelectLabel(this.x.disabled),this._isSelect&&this.$element.prop("disabled",!0),this)},enableSelect:function(){return this._debug("enableSelect"),this.isDisabled()&&(this.$select.removeClass(this.m.disabled),this._triggerEvent("onOptionChanged"),this._isSelect&&this.$element.prop("disabled",!1)),this},disableOptions:function(e){if(this._debug("disableOptions"),this.isDisabled())return this;var i=t();if(e)for(var s in e){var a=this._getOptionByValue(e[s]);a.hasClass(this.m.disabled)||(i=i.add(a))}else i=this.$dropdown.find("."+this.m.option).not("."+this.m.disabled);var n=this;return i.each(function(){var e=t(this);e.addClass(n.m.disabled),n._triggerEvent("onOptionDisabled",e)}),this._triggerEvent("onOptionChanged"),this},enableOptions:function(e){if(this._debug("enableOptions"),this.isDisabled())return this;var i=t();if(e)for(var s in e){var a=this._getOptionByValue(e[s]);a.hasClass(this.m.disabled)&&(i=i.add(a))}else i=this.$dropdown.find("."+this.m.disabled+"."+this.m.option);var n=this;return i.each(function(){var e=t(this);e.removeClass(n.m.disabled),n._triggerEvent("onOptionEnabled",e)}),this._triggerEvent("onOptionChanged"),this},addOption:function(t,i,s){this._debug("addOption");var a=this,n=this._getOptionByValue(t.value);if(n.length)return n.trigger("optionDuplicated"+o),this;var l,r,h=[];if(s){var d=this._getOptionByValue(s);d.hasClass(this.m.group)?(r=d,t.level=1):(r=this._getGroup(d),this._getUpperLevels(d,function(t){var e=parseInt(t.attr(a.a.dataLevel));h[e]=t.attr("id")}),t.level=parseInt(d.attr(a.a.dataLevel))+1,0===d.find("."+this.m.folder).length&&(d.children("a").append(this.t.folder),d.find("."+this.m.folder+"."+this.m.folderOpen).addClass(this.s.folderOpen),d.find("."+this.m.folder+"."+this.m.folderClose).addClass(this.s.folderClose))),r.length&&(h[0]=r.attr("id"),t.ingroup=!0),l=this.$dropdown.find("."+d.attr("id")).last(),0===l.length&&(l=d)}else i?(l=this._getOptionByValue(i),r=this._getGroup(l),this._getUpperLevels(l,function(t){var e=parseInt(t.attr(a.a.dataLevel));h[e]=t.attr("id")},!1),r.length&&(h[0]=r.attr("id"),t.ingroup=!0),t.level=parseInt(l.attr(a.a.dataLevel)),this.$dropdown.find("."+l.attr("id")).length&&(l=this.$dropdown.find("."+l.attr("id")).last())):t.level=1;t.ingroup===e&&(t.ingroup=!1);var u=this._getOid(),c=this._buildOptionHtml(t,u,h);l?l.after(c):this.$dropdown.append(c);var p=this.$dropdown.data("mapping");return p[t.value]=u,this.$dropdown.data("mapping",p),this._getOptionByValue(t.value).trigger("optionAdded"+o),this.$dropdown.is(":visible")&&(this._expandAllLevels(),this._updateIcons()),this},removeOption:function(t){this._debug("removeOption");var e=this._getOptionByValue(t);if(e.length){e.remove();var i=this.$dropdown.data("mapping");delete i[t],this.$dropdown.data("mapping",i),this.$element.trigger("optionRemoved"+o),this._triggerEvent("onOptionChanged"),this._updateIcons()}return this},clearAllOptions:function(){this._debug("clearAllOptions");var t=this.$dropdown.find("."+this.m.option),e=t.find("."+this.m.active).not("."+this.m.disabled).length;return t.length&&(this.toggleDropdown(!0),this.$element.empty(),this.$dropdown.empty().data("mapping",{}),this._delayed=!1,this.$element.trigger("optionRemoved"+o),e>0&&this._triggerEvent("onOptionChanged"),this._setSelectLabel(),this._updateIcons()),this},getGroup:function(e){if(this._debug("getGroup"),e.jquery)return e;var i=t(),s=this;return this.$dropdown.find("."+this.m.group).each(function(){var a=t(this).find("."+s.m.label).text();return a.indexOf(e)>-1?(i=t(this),!1):void 0}),i},getSelectedPairs:function(){if(this._debug("getSelectedPairs"),this.isDisabled())return e;var i={value:[],label:{},text:[]},s=this;return this._getSelectedOptions().each(function(){var e=t(this),a=s._getOptionValue(e),n=s._getOptionLabel(e);i.label[a]=n,i.value[i.value.length]=a,i.text[i.text.length]=n}),i},openDropdown:function(){return this.toggleDropdown(!1)},closeDropdown:function(){return this.toggleDropdown(!0)},toggleDropdown:function(e){if(this._debug("toggleDropdown"),this.isDisabled())return this;var i=this.$container.hasClass(this.m.open)?!0:!1;return e===!1&&(i=!1),e===!0&&(i=!0),i?this._triggerEvent("onDropdownHide",this.$container)&&(this.$container.removeClass(this.m.open),this._triggerEvent("onDropdownHidden",this.$container)):this._triggerEvent("onDropdownShow",this.$container)&&(this.o.closeOtherSmartSelect&&t("."+this.m.container).filter("."+this.m.open).not(this.$container).each(function(){var e=t(this).data(l);t(e).data(l).closeDropdown()}),this.$container.addClass(this.m.open),this._triggerEvent("onDropdownShown",this.$container)),this},unfoldOption:function(t){this._getOptionByValue(t).find("."+this.m.folderClose).trigger("click")},toggleOption:function(t,e,i){if(this._debug("toggleOption"),this.isDisabled())return this;var s=t.jquery?t:this._getOptionByValue(t);if(0===s.length)throw new Error(this.x.invalidOptionError);var a=e===!1?!1:!0;if(s.hasClass(this.m.disabled))return this;if(a&&!this._triggerEvent("onOptionChange",s))return this;var n=s.hasClass(this.m.active);return(i===!1||n)&&this._deselectOption(t),i!==!0&&n||this._selectOption(t),a&&!this._triggerEvent("onOptionChanged",s)?this:this},addCallback:function(e,i){return this._debug("addCallback"),this.c[e]?t.isArray(i)?t.merge(this.c[e],i):this.c[e].push(i):this.o.alert(this.x.callbackError+e),this},selectOption:function(t,e){return this._debug("selectOption"),this.toggleOption(t,e,!0)},deselectOption:function(t,e){return this._debug("deselectOption"),this.toggleOption(t,e,!1)},selectAllOptions:function(){if(this._debug("selectAllOptions"),this.isDisabled())return this;this._clearValues();var e=this._getGroup().not("."+this.m.disabled),i=this;return e.each(function(){var e=t(this);i.selectGroupOptions(e,!1)}),i.selectGroupOptions(),this},deselectAllOptions:function(t){return this._debug("deselectAllOptions"),this.isDisabled()?this:(t===!0?this.deselectOptions(this.getValues()):this.$dropdown.find("."+this.m.active+"."+this.m.option).not("."+this.m.disabled).removeClass(this.m.active),this._fireCallbacks("onPluginLoaded",this.$element),this)},selectGroupOptions:function(t,e){if(this._debug("selectGroupOptions"),this.isDisabled())return this;var i=this._isLevelInclusive(t);if(t){t=this.getGroup(t);var s=t.attr("id"),a=this.$dropdown.find("."+s+"."+this.m.option+(i?"":"."+this.a.dataLevel+"-1")).not("."+this.m.disabled).not("."+this.a.dataSpecial)}else var a=this.$dropdown.find("."+this.m.noGroup+"."+this.m.option+(i?"":"."+this.a.dataLevel+"-1")).not("."+this.m.disabled).not("."+this.a.dataSpecial);return!this._isGroupMultiple(t)||this._isAtMost()?this._selectMatchedOptions(a,!0,!0,e):(this._selectOption(a.first()),void this._quickSelectOptions(a,e))},deselectGroupOptions:function(t,e){if(this._debug("deselectGroupOptions"),this.isDisabled())return this;if(t){t=this.getGroup(t);var i=t.attr("id"),s=this.$dropdown.find("."+this.m.active+"."+i).filter("."+this.m.option).not("."+this.m.disabled)}else var s=this.$dropdown.find("."+this.m.active+"."+this.m.option).filter("."+this.m.noGroup).not("."+this.m.disabled);return 0===s.length?this:(this._isGroupMultiple(t)?this._quickSelectOptions(s,e,!1):this._selectMatchedOptions(s,!1,!0,e),this)},addAlias:function(e,i,s,a){if(this._debug("addAlias"),this.isDisabled())return this;if("string"!=typeof e){for(var n in e)this.addAlias(n,e[n],!1,!1);return this._matchAliasName(),this}t.isArray(i)||(i=[i]);for(var n in this.o.aliases){if(this._arrayEqual(this.o.aliases[n],i)){if(!this.o.confirm(this.x.aliasDupError))return this;this.removeAlias(n,!1,!1)}if(n===e){if(!this.o.confirm(this.x.aliasDupError))return this;this.removeAlias(n,!1,!1)}}return this.o.aliases[e]=i,s!==!1&&this._matchAliasName(),this._addAliasLine(e),a!==!1&&this.$element.trigger("aliasChange"+o),this},removeAlias:function(e,i,s){if(this._debug("removeAlias"),this.isDisabled())return this;if("string"==typeof e)delete this.o.aliases[e];else if(t.isArray(e)){for(var a in e)this.removeAlias(e[a],!1,!1);return this._setSelectLabel(),this._matchAliasName(),this.$element.trigger("aliasChange"+o),this}if(i!==!1&&(this._setSelectLabel(),this._matchAliasName()),this.$buttonAlias){var n=this;this.$buttonAlias.find("."+this.m.label).each(function(){t(this).text()===e&&t(this).closest("."+n.m.alias).remove()})}return s!==!1&&this.$element.trigger("aliasChange"+o),this},selectAlias:function(e){return this.$buttonAlias.find("."+this.m.label).each(function(){return t(this).text()===e?(t(this).click(),!1):void 0}),this},syncSelect:function(){return this._debug("syncSelect"),this._syncSelect(),this},_init:function(){if(this._debug("_init"),this._triggerEvent("onPluginLoad")){var t=[];this._isSelect?this._extractSelectData(t):t=this.o.data,this._buildPlugin(t),this._triggerEvent("onPluginLoaded")}},_debug:function(t,i){var s=2;try{if(i===e){i=0;for(var a=arguments.callee.caller;a&&!(++i>20);)a=a.caller}}catch(n){i=2}this.o.debug&&i<=this.o.debugLevel&&console.log(this._stringRepeat("    ",i-s)+i+" "+t+" "+ ++this.o.debug)},_selectOption:function(t,e){if(this._debug("_selectOption"),"string"==typeof t&&t.indexOf(this.o.specialValueSeperator)>-1)var i=t;var s=t.jquery?t:this._getOptionByValue(t);if(0===s.length)return!1;i&&this.o.setSpecialValue(i,s,this);var a=e===!1?!1:!0;return s.hasClass(this.m.active)?!0:s.hasClass(this.m.disabled)?!1:a&&!this._triggerEvent("onOptionSelect",s)?!1:(s.addClass(this.m.active),a&&!this._triggerEvent("onOptionSelected",s)?!1:!0)},_deselectOption:function(t,e){this._debug("_deselectOption");var i=t.jquery?t:this._getOptionByValue(t);if(0===i.length)return!1;var s=e===!1?!1:!0;return i.hasClass(this.m.active)?i.hasClass(this.m.disabled)?!1:s&&!this._triggerEvent("onOptionDeselect",i)?!1:(i.removeClass(this.m.active),s&&!this._triggerEvent("onOptionDeselected",i)?!1:!0):!0},_triggerEvent:function(t,e){this._debug("EVENT "+t);var i=e?e:this.$element;return i.trigger(t+o),this._fireCallbacks(t,i)},_fireCallbacks:function(t,e){var i=this.c[t],s=!0;for(var a in i)if(s="string"==typeof i[a]?this[i[a]].call(this,e,t):i[a].call(this,e,t),s===!1)return!1;return!0},_toggleFolder:function(e){this._debug("_toggleFolder");var i=this;e.each(function(e,s){var a=t(s),n=i.$dropdown.find("."+a.attr("id")),o=a.hasClass(i.m.group)?1:parseInt(a.attr(i.a.dataLevel))+1;a.hasClass(i.m.open)?(a.removeClass(i.m.open),n.addClass(i.m.hide+"-"+o)):(a.addClass(i.m.open),n.removeClass(i.m.hide+"-"+o))})},_getOptionByValue:function(i){if(this._debug("_getOptionByValue"),i.nodeName!==e)return t(i);if(i.jquery)return i;i=i.toString(),i.indexOf(this.o.specialValueSeperator)>-1&&(i=i.split(this.o.specialValueSeperator)[0]);var s=this.$dropdown.data("mapping");return s[i]?t("#"+s[i]):t()},_getGroup:function(e){this._debug("_getGroup");var i=t(),s=this.$dropdown.find("."+this.m.group);return e?(s.each(function(){var s=t(this),a=s.attr("id");return e.hasClass(a)?(i=s,!1):void 0}),i):s},_selectMatchedOptions:function(e,i,s,a){this._debug("_selectMatchedOptions");var n=a===!1?!1:!0;if(n&&!this._triggerEvent("onOptionChange"))return this;var o=this;return e.each(function(){var e=t(this);i===!1?o._deselectOption(e,s):o._selectOption(e,s)}),n&&this._triggerEvent("onOptionChanged"),this},_quickSelectOptions:function(t,e,i){this._debug("_quickSelectOptions");var s=e===!1?!1:!0;return s&&!this._triggerEvent("onOptionChange")?this:(i===!1?t.removeClass(this.m.active):t.addClass(this.m.active),s&&this._triggerEvent("onOptionChanged"),this)},_matchAliasName:function(){if(this._debug("_matchAliasName"),this.o.showSelectedInLabel){var t=this.getSelectedPairs().value,e=this.o.aliases;if(t.length)for(var i in e)if(this._toString(e[i]),e.hasOwnProperty(i)&&this._arrayEqual(t,e[i])){this.$select.find("."+this.m.label).html(i);break}}return!0},_addAliasLine:function(e){if(this.$buttonAlias){this._debug("_addAliasLine");var i=this,s=this.$buttonAlias.find("ul"),a=t(this.t.alias).appendTo(s);a.find("."+this.m.label).addClass(this.s.alias).text(e),a.find("."+this.m.icon).addClass(this.s.aliasIcon),i.o.disableUserAlias||a.find("."+this.m.caret).addClass(this.s.aliasCaret),s.find("."+this.m.alias).off().on(this.e.click,"."+this.m.label,function(e){var s=t(e.target).closest("."+i.m.alias).find("."+i.m.label).text();i.o.aliases[s].length>30&&i.o.optimized?i._quickSelectValues(i.o.aliases[s]):i.selectOptions(i.o.aliases[s]),e.stopPropagation(),e.preventDefault(),i.$buttonAlias.removeClass(i.m.open),i.o.viewAfterAlias&&i.$buttonView&&i.$buttonView.trigger("click"),i.o.closeAfterAlias&&i.$select.trigger("click")}).on(this.e.click,"."+this.m.caret,function(e){var s=t(e.target).closest("."+i.m.alias).find("."+i.m.label).text();i.removeAlias(s),e.stopPropagation(),e.preventDefault()})}},_updateIcons:function(){return this._debug("_updateIcons"),this.$dropdown.find("."+this.m.folder).filter(":visible").each(t.proxy(function(e,i){var s=t(i),a=s.closest("li"),n=a.attr("id"),o=parseInt(a.attr(this.a.dataLevel))+1,l=this.$dropdown.find("."+n+"."+this.a.dataLevel+"-"+o);l.filter(":hidden").length?a.removeClass(this.m.open):l.length?a.addClass(this.m.open):a.find("."+this.m.folder).remove()},this)),this.$buttonUnfold&&(this.$dropdown.find("."+this.m.option).not("."+this.m.disabled).filter(":hidden").length?this.$buttonUnfold.find("."+this.m.icon).removeClass(this.s.buttonFoldOpen).addClass(this.s.buttonUnfold):this.$buttonUnfold.find("."+this.m.icon).removeClass(this.s.buttonUnfold).addClass(this.s.buttonFoldOpen)),this},_extractSelectData:function(i,s){var a=this.a,n=this;if(s===e){this._debug("_extractSelectData");var o=this.$element.attr(a.dataAtLeast);o!==e&&(this.o.atLeast=parseInt(o));var l=this.$element.attr(a.dataAtMost);l!==e&&(this.o.atMost=parseInt(l)),this.$element.attr("disabled")!==e&&(this.o.disabled=!0)}(s?s:this.$element).children().each(function(o,l){var r=t(l),h={};if("OPTION"===l.nodeName){if(r.attr(a.dataDivider)!==e)return h[a.dataDivider]=!0,i[i.length]=h,!0;if(""===r.val().trim()&&""===r.text().trim())return!0;if(h.value=r.val(),h.label=r.text(),h.ingroup=s!==e,r.attr("disabled")!==e&&(h.disabled=!0),r.attr("selected")!==e){var d=n.o.initialValues.length;!n._isMultiple&&d||(n.o.initialValues[d]=h.value)}h.level=parseInt(r.attr(a.dataLevel)?r.attr(a.dataLevel):1);var u=r.attr(a.dataView);u!==e&&(h[a.dataView]=h.level+(u.length?parseInt(u):1)),r.attr(a.dataMust)!==e&&(h[a.dataMust]=!0);var c=r.attr(a.dataInclusive);c!==e&&(h[a.dataInclusive]=c.length?c:"_"),r.attr(a.dataNotSelectable)!==e&&(h.notSelectable=r.data("notSelectable")),i[i.length]=h}else{h.group=!0,h.label=r.attr("label");var p=r.attr(a.dataGroupExclusive);if(p!==e&&(h[a.dataGroupExclusive]=p.length?p:"_"),r.attr(a.dataExclusive)===e&&n._isMultiple||(h[a.dataExclusive]=!0),r.attr(a.dataLevelInclusive)!==e&&(h[a.dataLevelInclusive]=!0),r.attr(a.dataAtLeast)!==e)if(h[a.dataGroupExclusive])this.o.alert(n.o.text.groupExcludeError);else{var f=r.attr(a.dataAtLeast);h[a.dataAtLeast]=f.length?parseInt(f):1}r.attr(a.dataAtMost)!==e&&(h[a.dataAtMost]=parseInt(r.attr(a.dataAtMost)));var u=r.attr(a.dataView);u!==e&&(h[a.dataView]=u.length?parseInt(u):1),i[i.length]=h,n._extractSelectData(i,r)}})},_buildPlugin:function(t){return this._debug("_buildPlugin"),this._buildContainer()._buildSelect()._buildDropdown()._buildOption(t),this.o.delayedInit?this._delayed=!1:this._delayedInit(),this},_buildContainer:function(){return this._debug("_buildContainer"),this.$container=t(this.t.container).addClass(this.m.container+" "+this.s.container).insertAfter(this.$element).data(l,this.element),this},_buildSelect:function(){return this._debug("_buildSelect"),this.$select=t(this.t.select).addClass(this.s.select).appendTo(this.$container),this.$select.find("."+this.m.icon).addClass(this.s.selectIcon),this.$select.find("."+this.m.label).addClass(this.s.selectLabel).html(this.x.selectLabel),this.$select.find("."+this.m.caret).addClass(this.s.selectCaret),this},_buildDropdown:function(){return this._debug("_buildDropdown"),this._theId=this._uniqueId(),this.$dropdown=t(this.t.dropdown).addClass(this.s.dropdown).appendTo(this.$container).attr("id",this._theId),this.$select.off().not("."+this.m.disabled).on(this.e.click,t.proxy(function(t){this.toggleDropdown()},this)),this},_buildToolbar:function(){this._debug("_buildToolbar");var e=this.o.toolbar;if(e){this.$toolbar=t(this.t.toolbar).addClass(this.m.toolbar).addClass(this.s.toolbarPos).prependTo(this.$dropdown).children().addClass(this.s.toolbar);for(var i in e)e.hasOwnProperty(i)&&e[i]&&this["_"+i]&&this["_"+i]()}return this},_buildToolbtn:function(e,i){var s;return s=i?t(this.t.buttonToggle).addClass(this.s.buttonToggle):t(this.t.button).addClass(this.s.button).addClass(this.m.button),s.children("."+this.m.icon).addClass(e),i&&s.children("."+this.m.caret).addClass(this.s.buttonCaret),s},_buttonView:function(){this._debug("_buttonView");var e="string"==typeof this.o.toolbar.buttonView?this.o.toolbar.buttonView:"root+selected";this.$buttonView=this._buildToolbtn(this.s.buttonView).attr("title",this.x.buttonView).appendTo(this.$toolbar).on(this.e.buttonClick,t.proxy(function(){this._setDefaultView(e),this._updateIcons()},this))},_buttonUnfold:function(){this._debug("_buttonUnfold"),this.$buttonUnfold=this._buildToolbtn(this.s.buttonUnfold).attr("title",this.x.buttonUnfold).appendTo(this.$toolbar).on(this.e.buttonClick,t.proxy(function(){this.o.enableCollapseAll&&this.$buttonUnfold.find("."+this.m.icon).hasClass(this.m.expandAll)?this._expandAllLevels(!0):this._expandAllLevels(),this._updateIcons()},this))},_buttonCheckAll:function(){this._debug("_buttonCheckAll"),this._isMultiple&&(this.$buttonCheckAll=this._buildToolbtn(this.s.buttonCheckAll).attr("title",this.x.buttonCheckAll).appendTo(this.$toolbar).on(this.e.buttonClick,t.proxy(function(){this.selectAllOptions(),this.o.viewAfterCheckAll&&this.$buttonView?this.$buttonView.trigger("click"):this._updateIcons()},this)))},_buttonUnCheck:function(){this._debug("_buttonUnCheck"),this._isMultiple&&(this.$buttonUnCheck=this._buildToolbtn(this.s.buttonUnCheck).attr("title",this.x.buttonUnCheck).appendTo(this.$toolbar).on(this.e.buttonClick,t.proxy(function(){this.deselectAllOptions(this.o.forceUnCheckTriggerEvent),this.o.viewAfterCheckAll&&this.$buttonView&&this._setDefaultView(this.o.defaultView),this._updateIcons()},this)))},_buttonCancel:function(){this._debug("_buttonCancel"),this.$buttonCancel=this._buildToolbtn(this.s.buttonCancel).attr("title",this.x.buttonCancel).appendTo(this.$toolbar).on(this.e.buttonClick,t.proxy(function(){this._isChanged()&&this.selectOptions(this.$buttonCancel.data("cancel")),this.o.viewAfterCancel&&this.$buttonView?this.$buttonView.trigger("click"):this._updateIcons()},this))},_buttonAlias:function(){this._debug("_buttonAlias");var e=this;this.$buttonAlias=t(this.t.buttonGroup).addClass(this.s.buttonGroup+" "+this.m.button).attr("title",this.x.buttonAlias).appendTo(this.$toolbar).append(this._buildToolbtn(this.s.buttonAlias,!0)).on(this.e.buttonClick,"button",function(){e.$buttonAlias.hasClass(e.m.open)?e.$buttonAlias.removeClass(e.m.open):(e.$buttonAlias.addClass(e.m.open),e.o.disableUserAlias?e.$save.hide():e.$save.focus())});var i=t(this.t.dropdown).addClass(this.s.buttonDropdown);this.$buttonAlias.append(i);var s=t(this.t.liInput).addClass(this.s.liInput).appendTo(i);this.$save=s.find("input").addClass(this.s.inputBox).attr("placeholder",this.x.aliasPlaceholder).on("keydown",function(t){if(13===t.which&&""!==e.$save.val()){var i=e.getSelectedPairs().value;i.length?(e.addAlias(e.$save.val(),e.getSelectedPairs().value),e.$save.val(""),e.$buttonAlias.removeClass(e.m.open)):e.o.alert(e.x.emptyValuesError)}});for(var a in this.o.aliases)this._addAliasLine(a)},_buttonSearch:function(){this._debug("buttonSearch");var e=this;this.$buttonSearch=t(this.t.buttonGroup).addClass(this.s.buttonGroup+" "+this.s.dropup+" "+this.m.button).attr("title",this.x.buttonSearch).appendTo(this.$toolbar).append(this._buildToolbtn(this.s.buttonSearch,!0)).on(this.e.buttonClick,"button",function(t){e.$buttonSearch.toggleClass(e.m.open).siblings().removeClass(e.m.open),e.$buttonSearch.find("input").focus()});var i=t(this.t.dropdown).addClass(this.s.buttonDropdown);this.$buttonSearch.append(i);var s=t(this.t.liInput).addClass(this.s.liInput).appendTo(i),e=this;s.find("input").addClass(this.s.inputBox).attr("placeholder",this.x.searchPlaceholder).on("focus keyup",function(i){if(13===i.which)return!1;var s=t(this).val();e.o.searchTimeout&&clearTimeout(e.o.searchTimeout),e.o.searchTimeout=setTimeout(function(){e._searchOptions(s),e._updateIcons()},250)})},_buildOption:function(t){this._debug("_buildOption");for(var i={},s="",a="",n="",o=[""],l=t.length,r=0;l>r;++r){var h=t[r];if(h.group)a=this._getOid(),s+=this._buildOptGroupHtml(h,a),o=[a],h[this.a.dataAtLeast]&&(this._oneInGroup=!0);else if(h[this.a.dataDivider])s+=this._buildDividerHtml();else{n=this._getOid(),i[h.value]=n,h.level===e&&(h.level=1),h.notSelectable===e&&(h.notSelectable=!1);var d=t[r+1];d&&d.level&&d.level>h.level&&(h.children=!0),o[parseInt(h.level)]=n,s+=this._buildOptionHtml(h,n,o)}}return this.$dropdown.empty().data("mapping",i).append(s),this},_quickSelectValues:function(e,i){if(this._debug("_quickSelectValues"),this._triggerEvent("onOptionChange")){i!==!1&&this._clearValues();var s,a=this.$dropdown.data("mapping");for(var n in e)s=e[n],a[s]&&t("#"+a[s]).addClass(this.m.active);i!==!1&&this._fixEmptyLogic(),this._triggerEvent("onOptionChanged")}return this},_isChanged:function(){if(this._debug("_isChanged"),this.$buttonCancel){var t=this.$buttonCancel.data("cancel"),e=this.getSelectedPairs().value;if(this._arrayEqual(t,e))return!1}return!0},_getOid:function(){return this._ocnt===e&&(this._ocnt=0),this._theId+"-opt"+ ++this._ocnt},_buildDividerHtml:function(){return this.t.divider},_buildOptGroupHtml:function(t,e){var i='<li id="'+e+'" class="'+this.m.group+" "+this.m.hide+" "+(t[this.a.dataExclusive]?this.a.dataExclusive+" ":"")+(t[this.a.dataLevelInclusive]?this.a.dataLevelInclusive+" ":"")+(t[this.a.dataView]?this.a.dataView+" ":"")+'" '+this.a.dataLevel+'="0" '+(t[this.a.dataAtMost]?this.a.dataAtMost+'="'+t[this.a.dataAtMost]+'" ':"")+(t[this.a.dataAtLeast]?this.a.dataAtLeast+'="'+t[this.a.dataAtLeast]+'" ':"")+(t[this.a.dataView]?this.a.dataView+'="'+t[this.a.dataView]+'" ':"")+(t[this.a.dataGroupExclusive]?this.a.dataGroupExclusive+'="'+t[this.a.dataGroupExclusive]+'" ':"")+'><a><span class="'+this.m.label+'">'+t.label+"</span>"+this.t.folder+"</a></li>";return i},_buildOptionHtml:function(t,i,s){this._debug("_buildOptionHtml"),t.ingroup===e&&(s[0]!==e&&""!==s[0]?t.ingroup=!0:t.ingroup=!1);for(var a=[],n=t.ingroup===!1?1:0;n<t.level;n++)a[n]=s[n];var o='<li id="'+i+'" class="'+this.m.option+(t.notSelectable?" "+this.m.optionNotSelectable:"")+" "+(t.ingroup===!1?this.m.noGroup+" ":"")+this.m.hide+" "+(t.ingroup===!1?"":this.m.hide+"-"+t.level+" ")+a.join(" ")+" "+(t[this.a.dataView]?this.a.dataView+" ":"")+(t[this.a.dataMust]?this.a.dataMust+" ":"")+(t[this.a.dataSpecial]?this.a.dataSpecial+" ":"")+(t.disabled===!0?this.m.disabled+" ":"")+this.a.dataLevel+"-"+t.level+'" '+(t.level>1?this.a.dataUpper+'="'+a[t.level-1]+'" ':"")+(t[this.a.dataInclusive]?this.a.dataInclusive+'="'+t[this.a.dataInclusive]+'" ':"")+(t[this.a.dataView]?this.a.dataView+'="'+t[this.a.dataView]+'" ':"")+this.a.dataValue+'="'+t.value+'" '+this.a.dataLevel+'="'+t.level+'" ><a>'+(t.notSelectable?"":'<i class="'+this.m.checker+" "+this.s.checker+'"></i><i class="'+this.m.checkerNo+" "+this.s.checkerNo+'"></i>')+(t.html?t.html:'<span class="'+this.m.label+'">'+t.label+"</span>")+(t.children?this.t.folder:"")+"</a></li>";return o},_closeToolbar:function(){this.$toolbar&&(this._debug("_closeToolbar"),this.$toolbar.removeClass(this.m.open).find("."+this.m.open).removeClass(this.m.open))},_bindEvents:function(){this._debug("_bindEvents");var e=this,i=this.m;return this.$dropdown.off().on(this.e.click,function(){e._closeToolbar()}).on(this.e.click,"."+i.toolbar,function(t){return t.stopPropagation(),t.preventDefault(),!1}).on(this.e.click,"."+i.button,function(s){t(s.target).closest("."+e.m.button).siblings().removeClass(i.open)}).on(this.e.click,"."+i.folder,function(i){return e._toggleFolder(t(i.target).closest("li")),e._closeToolbar(),e._updateIcons(),!1}).on(this.e.click,"."+i.group,function(s){e.o.clickGroupOpen&&(e._toggleFolder(t(s.target).closest("."+i.group)),e._updateIcons())}).on(this.e.click,"."+i.option+":not(."+i.optionNotSelectable+")",function(s){var a=t(s.target).parentsUntil("."+i.option).andSelf();a.filter("."+i.noBubble).length||e.toggleOption(t(this))}),this.o.closeOnClickOutside&&t(document).on(this.e.click,function(i){0===t(i.target).parents("."+e.m.container).length&&t("."+e.m.container).filter("."+e.m.open).each(function(){var e=t(this).data(l);t(e).data(l).closeDropdown()})}),this},_expandAllLevels:function(e,i){this._debug("_expandAllLevels");var s=this;e?(this.$dropdown.find("."+this.m.option).each(function(e,i){var a=t(i);a.addClass(s.m.hide+"-"+a.attr(s.a.dataLevel))}),i===!1?this.$dropdown.find("."+this.m.group).addClass(s.m.hide+"-0"):this.$dropdown.find("."+this.m.group).removeClass(s.m.hide+"-0")):(this.$dropdown.find("."+this.m.option).removeClass(this._allHideClasses),this.$dropdown.find("."+this.m.group).removeClass(this.m.hide+"-0"))},_getUpperLevels:function(e,i,s){this._debug("_getUpperLevels");var a=parseInt(e.attr(this.a.dataLevel));if(s!==!1&&i(e),a>1){var n=t("#"+e.attr(this.a.dataUpper));s===!1&&i(n),this._getUpperLevels(n,i)}},_getOptionValue:function(t){return this._debug("_getOptionValue"),t.hasClass(this.a.dataSpecial)?this.o.getSpecialValue(t,this):t.attr(this.a.dataValue)},_getOptionLabel:function(t){return this._debug("_getOptionLabel"),t.hasClass(this.a.dataSpecial)?this.o.getSpecialLabel(t,this):t.children("a").text()},_getSelectedOptions:function(t){this._debug("_getSelectedOptions");var e=this.$dropdown.find("."+this.m.active+"."+this.m.option);return t===!1?e:e.not("."+this.m.disabled)},_setValues:function(t){this._debug("_setValues"),this._toString(t);for(var e in t)this._selectOption(t[e])||this.o.alert(this.x.valueSetError+t[e]);return this},_unSetValues:function(t){this._debug("_unSetValues"),this._toString(t);for(var e in t)this._deselectOption(t[e])||this.o.alert(this.x.valueSetError+t[e]);return this},_clearValues:function(){return this._debug("_clearValues"),this.$dropdown.find("."+this.m.active+"."+this.m.option).not("."+this.m.disabled).removeClass(this.m.active),this},_searchOptions:function(e){this._debug("_searchOptions");var i=this;e=e.replace(/(^\s*)|(\s*$)/g,""),""===e?this._expandAllLevels():(this._expandAllLevels(!0,!1),this.$dropdown.find("."+this.m.option).not("."+this.m.disabled).each(function(){var s=t(this),a=i._getOptionValue(s),n=i._getOptionLabel(s),o=n;"value"===i.o.searchBy?o=a:"both"===i.o.searchBy&&(o=n+" "+a),i.o.searchCaseInsensitive&&(e=e.toLowerCase(),o=o.toLowerCase()),o.indexOf(e)>-1&&(i._getUpperLevels(s,function(t){t.removeClass(i._allHideClasses)}),i._getGroup(s).removeClass(i.m.hide+"-0"))}),this._updateIcons())},_uniqueId:function(){return this._debug("_uniqueId"),"s"+(Math.random()+1).toString(36).slice(-5)},_hasClasses:function(t,e){this._debug("_hasClasses");for(var i=e.split(" "),s=0,a=i.length;a>s;s++)if(!t.hasClass(i[s]))return!1;return!0},_toString:function(t){this._debug("_toString");for(var e in t)t[e]=t[e].toString()},_isPeer:function(t,e){return this._debug("_isPeer"),t.attr(this.a.dataUpper)===e.attr(this.a.dataUpper)},_isDataInclusive:function(t,e){if(this._debug("_isDataInclusive"),this._isPeer(t,e)){var i=t.attr(this.a.dataInclusive),s=e.attr(this.a.dataInclusive);return this._charOverlap(i,s)}return!1},_isGroupExclusive:function(t,i){this._debug("_isGroupExclusive");var s=t?t.attr(this.a.dataGroupExclusive):e,a=i?i.attr(this.a.dataGroupExclusive):e;return!this._charOverlap(s===e?".":s,a===e?".":a)},_isGroupMultiple:function(t){return this._debug("_isGroupMultiple"),t&&t.length?!t.hasClass(this.a.dataExclusive):!(this._isMultiple&&this._isDataExclusive)},_isLevelInclusive:function(t){return this._debug("_isLevelInclusive"),t&&t.length?t.hasClass(this.a.dataLevelInclusive)||this.o.dataLevelInclusive:this.o.dataLevelInclusive},_charOverlap:function(t,e){this._debug("_charOverlap");var i=t?t.split(" "):[],s=e?e.split(" "):[],a=i.filter(function(t){return-1!==s.indexOf(t)});return a.length?!0:!1},_arrayEqual:function(t,e){return this._debug("_arrayEqual"),t.length!==e.length||t.filter(function(t){return-1===e.indexOf(t)}).length+e.filter(function(e){return-1===t.indexOf(e)}).length>0?!1:!0},_stringRepeat:function(t,e){for(var i="",s=0;e>s;s++)i+=t;return i},_fixPluginOptions:function(){this._debug("_fixPluginOptions"),this._isSelect="SELECT"===this.element.nodeName,this._isMultiple=this.o.multiple?!0:!1,this._isSelect&&this.$element.attr("multiple")===e&&(this._isMultiple=!1),this._isSelect&&this.$element.attr(this.a.dataExclusive)!==e&&(this._isDataExclusive=!0),this._isMultiple||(this.o.closeOnSelect=!0),this.o.optimized&&(this.o.delayedInit=!0,this.o.keepInSync=!1,this.o.debug=0),null===this.o.defaultValues||this.o.atLeast||(this.o.atLeast=1);for(var t in this.o.handler)this.o.handler.hasOwnProperty(t)&&this.$element.on(t+o,this.o.handler[t]);this._allHideClasses="";for(var t=1;t<=this.o.maxLevels;t++)this._allHideClasses+=this.m.hide+"-"+t+" ";return!0},_hideOriginalSelect:function(){return this._debug("_hideOriginalSelect"),this._isSelect&&this.$element.hide(),!0},_setDefaultValues:function(){return this._debug("_setDefaultValues"),this._clearValues(),this.o.initialValues.length?(this._setValues(this.o.initialValues),this.o.initialValues.length=0):null!==this.o.defaultValues&&this._setValues(this.o.defaultValues),!0},_disabledSelect:function(){this._debug("_setDefaultValues"),this._isSelect&&this.o.disabled===!0&&this.disableSelect()},_fixEmptyLogic:function(t,e){return this._debug("_fixEmptyLogic"),this._mustSelect(t,e)&&this._atLeastInGroup(t,e)&&this._atLeast(t,e)?!0:!1},_atLeast:function(e,i){if(this._debug("_atLeast"),!this.o.atLeast)return!0;var s=this._getSelectedOptions(),a=this.o.atLeast;return"onOptionDeselect"===i?s.not(e).length+1>a?!0:1===a&&null!==this.o.defaultValues&&(this._setValues(this.o.defaultValues),-1===t.inArray(this._getOptionValue(e),this.o.defaultValues))?!0:(this.$element.trigger("atLeast"+o),!1):"onOptionDisabled"===i?s.length>=a?!0:(1===a&&null!==this.o.defaultValues&&this._setValues(this.o.defaultValues),s=this._getSelectedOptions(),s.length>=a?!0:(this._selectMatchedOptions(this.$dropdown.find("."+this.m.option).not("."+this.m.disabled).not("."+this.m.active).slice(0,a-s.length),!0,!0,!1),!0)):s.length>=a?!0:(null!==this.o.defaultValues&&(this._setValues(this.o.defaultValues),s=this._getSelectedOptions()),s.length<a&&this._selectMatchedOptions(this.$dropdown.find("."+this.m.option).not("."+this.m.disabled).not("."+this.m.active).slice(0,a-s.length),!0,!0,!1),!0)},_mustSelect:function(t,e){if(this._debug("_mustSelect"),this.o.mustSelect.length>0){var i=this.o.mustSelect;for(var s in i){var a=this._getOptionByValue(i[s]);a.addClass(this.a.dataMust)}this.o.mustSelect.length=0}var n=this.$dropdown.find("."+this.a.dataMust).not("."+this.m.disabled);return 0===n.length?!0:"onOptionDeselect"===e?n.filter(t).length?(this.$element.trigger("mustSelect"+o),!1):!0:("onPluginLoaded"===e&&this._selectMatchedOptions(n,!0,!0,!1),!0)},_atMost:function(t,e){if(this._debug("_atMost"),!this._isAtMost())return!0;var i=this._getGroup(t);if(i.length&&i.is("["+this.a.dataAtMost+"]")){var s=parseInt(i.attr(this.a.dataAtMost));if(this.$dropdown.find("."+this.m.active+"."+i.attr("id")).not("."+this.m.disabled).length===s)return this.$element.trigger("atMost"+o),!1}if(!this.o.atMost)return!0;var a=this._getSelectedOptions();return a.length<this.o.atMost?!0:(this.$element.trigger("atMost"+o),!1)},_isAtMost:function(){return this._atmost!==e?this._atmost:this.o.atMost?(this._atmost=!0,this._atmost):this.$dropdown.find("."+this.m.group).not("."+this.m.disabled).filter("["+this.a.dataAtMost+"]").length?(this._atmost=!0,this._atmost):(this._atmost=!1,this._atmost)},_atLeastInGroup:function(e,i){if(this._debug("_atLeastInGroup"),!this._oneInGroup)return!0;if("onOptionDeselect"===i){var s=this._getGroup(e);if(0===s.length)return!0;if(!s.is("["+this.a.dataAtLeast+"]"))return!0;var a=parseInt(s.attr(this.a.dataAtLeast));return this._getSelectedOptions().filter("."+s.attr("id")).length>a?!0:(this.$element.trigger("atLeast"+o),!1)}if("onOptionDisabled"===i){var s=this._getGroup(e);if(0===s.length)return!0;if(!s.is("["+this.a.dataAtLeast+"]"))return!0;var n=s.attr("id"),a=parseInt(s.attr(this.a.dataAtLeast)),l=this._getSelectedOptions().filter("."+n).length;return l>=a?!0:(this._selectMatchedOptions(this.$dropdown.find("."+n).not("."+this.m.disabled).not("."+this.m.active).slice(0,a-l),!0,!0,!1),!0)}var r=this;return this._getGroup().filter("["+this.a.dataAtLeast+"]").each(function(){var e=t(this),i=parseInt(e.attr(r.a.dataAtLeast)),s=r._getSelectedOptions().filter("."+e.attr("id")).length;return s>=i?!0:void r._selectMatchedOptions(r.$dropdown.children("."+e.attr("id")).not("."+r.m.disabled).slice(0,i),!0,!0,!1)}),!0},_fixSelectLogic:function(i){this._debug("_fixSelectLogic");var s=this._getSelectedOptions().not(i);if(0===s.length)return!0;var a=this;if(this._isMultiple===!1)return s.each(function(){a._deselectOption(this)}),!0;var n=this._getGroup(i),o=parseInt(i.attr(this.a.dataLevel)),l=this.$dropdown.find("."+this.m.group).not("."+this.m.disabled).not(n),r=[];l.each(function(){r[r.length]=t(this)});for(var h in r){var d=r[h];a._isGroupExclusive(n,d)&&a.deselectGroupOptions(d,!1)}if(n.length&&a._isGroupExclusive(n)&&a.deselectGroupOptions(e,!1),!this._isGroupMultiple(n)){var u=this.$dropdown.find("."+this.m.active+"."+this.m.option).filter("."+(n.length?n.attr("id"):this.m.noGroup)).not("."+this.m.disabled).not(i);u.each(function(){var e=t(this);a._isDataInclusive(i,e)||a._deselectOption(e)})}if(!this._isLevelInclusive(n)){this.$dropdown.find("."+i.attr("id")+"."+this.m.active).not("."+this.m.disabled).removeClass(this.m.active);var u=this.$dropdown.find("."+this.m.active+"."+this.m.option).filter("."+(n.length?n.attr("id"):this.m.noGroup)).not("."+this.m.disabled).not(i);if(o>1&&u.length){var c=i.attr(this.a.dataUpper),p=this.$dropdown.find("."+c).filter("."+this.a.dataLevel+"-"+o).not("."+this.m.disabled),f=p.not("."+this.m.active).length;1===p.length||f>0?this._getUpperLevels(i,function(t){t.hasClass(a.m.active)&&a._deselectOption(t)},!1):0===f&&this._selectOption(t("#"+c))}}return!0},_setSelectLabel:function(t){if(this.o.showSelectedInLabel){this._debug("_setSelectLabel");var e;if("string"==typeof t){var i=t;e=t}else{var i=this.x.selectLabel;e=i;var s=this.getSelectedPairs().text;s.length&&(e=s.join(","),i=this.o.showSelectedCallback?this.o.showSelectedCallback.call(this,s):s.length<=this.o.showSelectedCount?s.join(this.o.showSelectedSeperator):this.x.labelTemplate.replace("#",s.length))}this.$select.find("."+this.m.label).attr("title",e).html(i)}return!0},_saveOldValues:function(){return this._debug("_saveOldValues"),this.$buttonCancel&&this.$buttonCancel.data("cancel",this.getSelectedPairs().value),!0},_delayedInit:function(){return this._delayed===!0?!0:(this._debug("_delayedInit"),this.$dropdown.find("."+this.m.folder+"."+this.m.folderOpen).addClass(this.s.folderOpen),this.$dropdown.find("."+this.m.folder+"."+this.m.folderClose).addClass(this.s.folderClose),this.$dropdown.find("."+this.m.divider).addClass(this.s.divider),this._buildToolbar()._bindEvents(),this._setDefaultView(),this._delayed=!0,!0)},_setDefaultView:function(e){var i=this,s=(e?e:this.o.defaultView).split("+");return t.inArray("expand",s)>-1?(this._expandAllLevels(),!0):(this._expandAllLevels(!0),t.inArray("root",s)>-1&&this.$dropdown.find("."+this.m.noGroup).removeClass(this._allHideClasses),t.inArray("level1",s)>-1&&this.$dropdown.find("."+this.m.option).filter("["+this.a.dataLevel+"=1]").removeClass(this._allHideClasses),t.inArray("level2",s)>-1&&(this.$dropdown.find("."+this.m.option).filter("["+this.a.dataLevel+"=1]").removeClass(this._allHideClasses),this.$dropdown.find("."+this.m.option).filter("["+this.a.dataLevel+"=2]").removeClass(this._allHideClasses)),t.inArray("selected",s)>-1&&this.$dropdown.find("."+this.m.active+"."+this.m.option).not("."+this.m.disabled).each(function(e,s){var a=t(s);i._getUpperLevels(a,function(t){t.removeClass(i._allHideClasses)})}),t.inArray("view",s)>-1&&this.$dropdown.find("."+this.a.dataView).not("."+this.m.disabled).each(function(e,s){var a=t(s);i._getUpperLevels(a,function(t){t.removeClass(i._allHideClasses)});var n=a.attr("id"),o=parseInt(a.attr(i.a.dataView));o=4>o?o:1;for(var e=1;o>=e;++e)i.$dropdown.find("."+n+"."+i.a.dataLevel+"-"+e).removeClass(i._allHideClasses)}),!0)},_closeOnSelect:function(){this.o.closeOnSelect&&this.$select.trigger("click")},_syncSelect:function(){if(this._isSelect){this._debug("_syncSelect");var t=this.o.keepInSync;this.o.keepInSync=!0,this._flushSelect(),this.o.keepInSync=t}return!0},_flushSelect:function(){if(this._isSelect&&this.o.keepInSync){this._debug("_flushSelect");var e=this.getSelectedPairs().value;this.$element.find("option:selected").prop("selected",!1),e.length&&this.$element.find("option").each(function(){var i=t(this).val();t.inArray(i,e)>-1&&t(this).prop("selected",!0)})}return!0}};var r=t.fn[n];t.fn[n]=s,t.fn[n].Constructor=i,t.fn["get"+n]=function(){return this.first().data(l)},t.fn[n].noConflict=function(){return t.fn[n]=r,this}}(window.jQuery);
